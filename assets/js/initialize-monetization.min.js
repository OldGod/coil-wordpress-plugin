/*! Coil Monetize Content for WordPress v1.0.1 Wednesday 4th December 2019 17:35:11 PM GMT+0000 */
!function(c){if("undefined"==typeof coil_params)return;var o=coil_params.content_container,e=coil_params.browser_extension_missing,t=coil_params.unable_to_verify,n=coil_params.voluntary_donation,i=coil_params.loading_content,s=coil_params.partial_gating,a=coil_params.post_excerpt,r=coil_params.admin_missing_id_notice;site_logo=coil_params.site_logo;var l=wp.template("subscriber-only-message"),d=wp.template("split-content-message"),u=wp.template("banner-message"),m=c("p.monetize-msg");function p(e,o){var t=document.createElement("p");return t.classList.add("monetize-msg"),o&&t.classList.add(o),t.innerHTML=e,t}function g(e){var o=document.createElement("div");o.classList.add("entry-content","coil-message-container");var t={headerLogo:site_logo,title:"This content is for subscribers only",content:e,button:{text:"Get coil to access",href:"https://coil.com/learn-more/"}};return c(o).append(l(t)),o}function b(e){var o=document.createElement("div");o.classList.add("coil-banner-message-container");var t={content:e,button:{text:"Get Coil to access",href:"https://coil.com/learn-more/"}};return c(o).append(u(t)),o}function f(){document.querySelector(o).style.display="block"}function y(){if(""!==a)return jQuery("<p>").addClass("coil-post-excerpt").text(a).prop("outerHTML")}function h(){return jQuery("p.coil-post-excerpt").hide()}function z(){return document.body.classList.contains("coil-no-gating")}function v(){return document.body.classList.contains("coil-gate-all")}function w(){return document.body.classList.contains("coil-gate-tagged-blocks")}function S(){return".content-area .entry-content"===o}function C(){return!!document.body.classList.contains("coil-show-excerpt")}function L(){if(console.log("Verification Failure"),0<c("p.monetize-msg").length)if(c("p.monetize-msg").remove(),v()){var e=c("p.coil-post-excerpt");0<e.length?e.after(p(t,"monetize-failed")):(document.body.classList.add("show-fw-message"),c(o).before(g(t)))}else w()?(console.log("Unable to verify hidden content"),c("body").addClass("coil-split"),f(),document.querySelector(o).before(p(t,"monetize-failed"))):(console.log("No tagged blocks"),document.body.classList.add("show-fw-message"),document.querySelector(o).before(g(t)))}function x(){return document.body.classList.contains("monetization-not-initialized")}function _(e){c("#js-coil-banner-dismiss").on("click",function(){M(e)||("ShowCoilPublicMsg"===e?Cookies.set(e,1,{expires:31}):"ShowCoilPartialMsg"===e&&Cookies.set(e,1),c(this).parent().parent().remove())})}function M(e){var o=Cookies.get(e);return void 0!==o&&("ShowCoilPublicMsg"===e||"ShowCoilPartialMsg"===e)&&"1"===o}c(document).ready(function(){if(x())if(v()&&void 0!==a&&void 0!==document.monetization&&"stopped"!==document.monetization.state&&""!==a&&document.querySelector(o).before(y()),z()||S()||c(o).not(".coil-post-excerpt").hide(),void 0!==document.monetization){switch(document.monetization.state){case"pending":document.body.classList.contains("coil-missing-id")?(document.body.classList.contains("coil-show-admin-notice")?c(o).before('<p class="monetize-msg">'+r+"</p>"):c("body").removeClass("coil-missing-id"),z()||S()||(f(),c(o+"*.coil-hide-monetize-users").css("display","none"),c(o+"*.coil-show-monetize-users").css("display","none")),c("body").trigger("coil-missing-id")):z()?x()&&!M("ShowCoilPublicMsg")&&(c("body").append(b(n)),_("ShowCoilPublicMsg")):(v()?""!==a?(console.log("Subscriber gating and no post excerpt...Verifying extension"),document.querySelector(o).before(p(i,""))):(console.log("Subscriber gating and has post excerpt...Verifying extension"),c("div.coil-post-excerpt").after(p(i,""))):document.querySelector(o).before(p(i,"")),setTimeout(function(){console.log("Verifying Coil account"),m.html(i)},2e3),setTimeout(function(){L()},5e3));break;case"started":console.log("Monetization state: Started"),document.querySelector(o).before(p(i,""));break;case"stopped":v()?(C()&&""!==a&&document.querySelector(o).insertAdjacentHTML("beforebegin",y()),document.querySelector(o).insertAdjacentHTML("beforebegin",'<p class="monetize-msg">'+i+"</p>")):w()&&document.querySelector(o).insertAdjacentHTML("beforebegin",'<p class="monetize-msg">'+i+"</p>"),setTimeout(function(){"undefined"==typeof monetizationStartEventOccurred&&(c("p.monetize-msg").text()===i?(console.log("Monetization not started and verification failed"),L()):z()&&(console.log("Content is monetized and public but extension is stopped"),M("ShowCoilPublicMsg")||(c("body").append(b(n)),_("ShowCoilPublicMsg"))))},5e3)}document.monetization.addEventListener("monetizationstart",function(e){e.detail.paymentPointer,e.detail.requestId;monetizationStartEventOccurred=!0,z()||S()||(f(),document.body.classList.remove("show-fw-message"),C()&&h()),c("body").removeClass("monetization-not-initialized").addClass("monetization-initialized"),m.remove(),C()||c("div.coil-post-excerpt").remove(),document.querySelectorAll("iframe, object, video").forEach(function(e){if(e.classList.contains("intrinsic-ignore")||e.parentNode.classList.contains("intrinsic-ignore"))return!0;e.dataset.origwidth||(e.setAttribute("data-origwidth",e.width),e.setAttribute("data-origheight",e.height))}),c("body").trigger("coil-monetization-initialized",[e]),0<c("p.monetize-msg").length&&(c("p.monetize-msg").remove(),h(),f())}),document.monetization.addEventListener("monetizationprogress",function(e){var o=e.detail.paymentPointer,t=e.detail.requestId,n=e.detail.amount,i=e.detail.assetCode,s=e.detail.assetScale;c("body").trigger("coil-monetization-progress",[e,o,t,n,i,s])})}else console.log("Coil Extension not found or using unsupported browser"),c("body").removeClass("monetization-not-initialized").addClass("coil-extension-not-found"),v()?(S()?c(o).before(g(e)):c(o).html(g(e)),C()?(document.body.classList.add("show-excerpt-message"),c(o).prepend(y())):document.body.classList.add("show-fw-message")):w()?(console.log("Split content with no extension found"),c(".coil-show-monetize-users").prepend(function(e){return d(e)}(s)),M("ShowCoilPartialMsg")||(c("body").append(b(s)),_("ShowCoilPartialMsg"))):z()&&(console.log("Content is monetized and public but no extension found"),M("ShowCoilPublicMsg")||(c("body").append(b(n)),_("ShowCoilPublicMsg"))),c("body").trigger("coil-extension-not-found")})}(jQuery);